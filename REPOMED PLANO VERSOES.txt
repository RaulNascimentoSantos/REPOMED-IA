REPOMED IA ‚Äî MASTER EXECUTION PLAN (V1 + V2 + V3)
Data: 31/08/2025 ‚Äî Fuso: America/Sao_Paulo
Autores: Raul (Engenheiro/PM), M√©dica (Product Advisor), Claude Coder (Executor), ChatGPT (Arquiteto)
Formato: Documento TXT operacional para colar nos prompts do Claude Coder e gerar TODO o c√≥digo local-first, reaproveitando o PaperFlow.

====================================================================
0) VIS√ÉO R√ÅPIDA (Elevator Pitch)
====================================================================
Problema: M√©dicos gastam tempo com documentos repetitivos (atestados, receitas, laudos, termos) e assumem risco por falta de padroniza√ß√£o e assinatura v√°lida.
Solu√ß√£o: RepoMed IA ‚Äî reposit√≥rio ‚Äúmedical-grade‚Äù de templates cl√≠nicos + gera√ß√£o assistida por IA + assinatura ICP‚ÄëBrasil + trilha de auditoria + busca cl√≠nica.
P√∫blico: M√©dico solo, cl√≠nica popular, consult√≥rios pequenos/m√©dios. Primeiro Brasil.
Tese: Ganho de tempo real (‚Äúone‚Äëclick doc‚Äù) + seguran√ßa e conformidade (LGPD/CFM/ICP).
Abordagem: LOCAL-FIRST para valida√ß√£o r√°pida com m√©dica; depois evolui para SaaS multi-tenant.

====================================================================
1) PRINC√çPIOS GUIA
====================================================================
‚Ä¢ Tempo do m√©dico √© ouro ‚Üí fluxos em 1‚Äì2 cliques, defaults cl√≠nicos, atalhos de teclado.
‚Ä¢ Seguran√ßa sem atrito ‚Üí ICP nativo, links com expira√ß√£o, QR/Hash, HMAC em webhooks.
‚Ä¢ Qualidade > quantidade ‚Üí biblioteca curada e versionada com processo editorial.
‚Ä¢ Engenharia pragm√°tica ‚Üí reaproveitar 70% do PaperFlow (monorepo, endpoints, observabilidade, seguran√ßa).

====================================================================
2) REUSO DO PAPERFLOW ‚Üí REPOMED (MAPA DE CLONAGEM/RENOMEA√á√ÉO)
====================================================================
Clonar e renomear pacotes/componentes:
  A) API Gateway (Fastify + TS) ‚Üí repomed-api
  B) Web (React + Vite + Tailwind + shadcn) ‚Üí repomed-web
  C) Observabilidade (Prometheus /metrics, logs pino) ‚Üí manter
  D) Seguran√ßa (API keys, rate limit, CORS/Helmet, HMAC webhooks) ‚Üí manter
  E) Infra (Docker Compose: Postgres16 + pgvector, Redis, MinIO) ‚Üí manter
  F) M√≥dulos ‚Äúdocuments / pii / bates / custody / webhooks‚Äù ‚Üí adaptar para dom√≠nio m√©dico:
     ‚Ä¢ documents ‚Üí clinical-docs
     ‚Ä¢ pii       ‚Üí phi (PHI cl√≠nica, novas regex e dicion√°rios)
     ‚Ä¢ bates     ‚Üí clinical-ids (carimbo cl√≠nico: CRM + data/hora + hash + QR)
     ‚Ä¢ custody   ‚Üí clinical-audit (trilha forense)
     ‚Ä¢ webhooks  ‚Üí clinical-webhooks (doc.generated, doc.signed, doc.shared)
  G) Demo local e SSE ‚Üí manter

Namespaces/Rotas (alvos):
  paperflow-* ‚Üí repomed-*
  /v1/documents ‚Üí /v1/clinical-docs
  /v1/pii       ‚Üí /v1/phi
  /v1/bates     ‚Üí /v1/clinical-ids
  /v1/custody   ‚Üí /v1/clinical-audit
  /v1/webhooks  ‚Üí /v1/clinical-webhooks
  (Novos) /v1/medical-templates, /v1/signature, /v1/search, /v1/workspaces

====================================================================
3) ARQUITETURA E STACK (COMUM √ÄS VERS√ïES)
====================================================================
Stack base:
  ‚Ä¢ Backend: Node 20, Fastify, TypeScript estrito, Zod (DTO), OpenAPI (Swagger), pnpm, vitest/jest.
  ‚Ä¢ Frontend: React 18, Vite, Tailwind, shadcn/ui, Framer Motion, react-hook-form, zod/resolvers.
  ‚Ä¢ Infra local: Docker Compose ‚Äî PostgreSQL 16 (com pgvector), Redis, MinIO (S3). Proxy opcional (Caddy/Nginx).
  ‚Ä¢ Observabilidade: /metrics (Prometheus), logs JSON (pino), traceId.
  ‚Ä¢ Seguran√ßa: helmet, CORS estrito, rate limit por chave, API Keys/PAT, HMAC em webhooks. JWT opcional para sess√µes web.
  ‚Ä¢ Build/Repo: PNPM workspaces + Turborepo; eslint/prettier/husky; commitlint (opcional).

Monorepo (proposta):
  /apps
    repomed-api
    repomed-web
  /packages
    ui         (design system, tokens OKLCH medical)
    schemas    (DTOs zod compartilhados)
    sdk        (client TS da API)
    prompts    (prompt‚Äëlibrary cl√≠nica)
  /infra
    docker-compose.yml
    db/migrations  (SQL)
    ops/scripts    (Makefile, seeds, dev-utils)
  /docs (arquitetura, compliance, playbooks)

Servi√ßos do backend:
  auth (keys, users) | workspaces (V2 b√°sico, V3 avan√ßado/tenant)
  medical-templates | generator (IA) | clinical-docs (PDF/QR/Hash/Share)
  signature (ICP)   | clinical-audit | search (pgvector) | webhooks | admin

Ambiente (.env exemplo):
  NODE_ENV=development
  PORT=3002
  DATABASE_URL=postgres://postgres:postgres@localhost:5432/repomed
  REDIS_URL=redis://localhost:6379
  S3_ENDPOINT=http://localhost:9000
  S3_BUCKET=repomed-local
  S3_ACCESS_KEY=admin
  S3_SECRET_KEY=admin123
  JWT_SECRET=change-me
  OPENAI_API_KEY=replace-if-needed
  ICP_PROVIDER=mock
  ENABLE_PGVECTOR=true

Docker Compose (blocos):
  - postgres:16 com extens√£o pgvector + healthcheck
  - redis:latest + healthcheck
  - minio:latest + script init bucket
  - (opcional) caddy/nginx reverse proxy
  - redes e volumes nomeados

====================================================================
4) V1 ‚Äî FOUNDATIONAL MVP (LOCAL-FIRST, SINGLE USER)
====================================================================
Objetivo: validar UX com m√©dica e comprovar fluxo E2E local sem depend√™ncias externas cr√≠ticas.

4.1 Escopo V1
  [1] 15 templates cl√≠nicos iniciais (Cl√≠nica, Pediatria, GO, Dermato, Ortopedia).
  [2] Template Studio: CRUD b√°sico (t√≠tulo, especialidade, body_md, fields).
  [3] Gera√ß√£o de documento com preenchimento manual guiado + PDF.
  [4] Assinatura mock (provider=mock) com metadados para futura troca por ICP real.
  [5] QR/Hash do documento + link de compartilhamento com expira√ß√£o.
  [6] Clinical Audit b√°sico (quem, quando, o qu√™) + export JSONL/CSV.
  [7] Observabilidade e seguran√ßa baseline (rate limit, keys, HMAC webhooks).
  [8] UI clean: One‚ÄëClick Doc (buscar‚Üíselecionar‚Üípreencher‚Üíassinar‚Üíexportar/compartilhar).

4.2 Modelo de Dados (conceitual V1)
  patients(id, name, dob, doc_idents[], created_at)
  practitioners(id, crm, name, email, signature_cert_ref, created_at)
  templates(id, specialty, title, version, body_md, fields_json, curator_id, reviewed_at, tags[])
  documents(id, patient_id, practitioner_id, template_id, fields_json, pdf_url,
            hash_before, hash_after, signed_at, signature_provider, audit_id, qr_code, share_expires_at)
  audits(id, document_id, actor_id, operation, ts, meta_json)

4.3 Endpoints (V1 m√≠nimo)
  GET  /v1/health | GET /v1/metrics | GET /docs
  Templates: POST/GET/PUT/DEL /v1/medical-templates
  Docs: POST /v1/clinical-docs | GET /v1/clinical-docs/:id | DEL /v1/clinical-docs/:id
        POST /v1/clinical-docs/:id/sign (provider=mock)
        POST /v1/clinical-docs/:id/share {expiresIn}
  Audit:  GET /v1/clinical-audit/:docId/export?format=jsonl|csv
  Webhooks (HMAC): POST /v1/clinical-webhooks/test

4.4 Schemas (Zod/DTO V1)
  TemplateCreate: { title, specialty, body_md, fields: Array<{id,label,type,required,options?}> }
  DocumentCreate: { templateId, fields: Record<string, any>, patient?: {name,dob,docId?}, practitioner?: {crm,name} }
  SignatureRequest: { provider: 'mock' }
  ShareRequest: { expiresIn: number }

4.5 UI/UX (V1)
  ‚Ä¢ Tema OKLCH ‚Äúmedical blue/green‚Äù acess√≠vel, tipografia leg√≠vel, foco em formul√°rio.
  ‚Ä¢ Componentes: TemplateCard, NewDocument form, PDFPreview, SignaturePanel, ShareSheet.
  ‚Ä¢ Atalhos: ‚Äú/‚Äù para busca, ‚ÄúEnter‚Äù para avan√ßar/gerar, ESC para cancelar.
  ‚Ä¢ Empty states e onboarding curto (3 passos).

4.6 Setup Local (V1)
  1) Clonar PaperFlow, renomear para repomed, ajustar package.json.
  2) docker-compose up -d (postgres, redis, minio).
  3) pnpm i; pnpm -w dev (api 3002, web 5173).
  4) Rodar migrations (0001‚Ä¶0005) e seeds (5‚Äì10 templates b√°sicos).
  5) Validar: /health, /metrics, /docs; criar 1 doc fim‚Äëa‚Äëfim.

4.7 Testes/Qualidade (V1)
  ‚Ä¢ Unit: schemas, services (pdf/hash/qr), assinatura mock.
  ‚Ä¢ E2E: criar doc ‚Üí assinar ‚Üí exportar ‚Üí link/QR ‚Üí abrir e validar hash.
  ‚Ä¢ Seguran√ßa: rate limit e HMAC em /clinical-webhooks/test.
  ‚Ä¢ Crit√©rios de aceite: cria√ß√£o < 90s; lat√™ncia p95 < 500ms em CRUD; logs/audit coerentes.

====================================================================
5) V2 ‚Äî MVP++ (BETA FECHADO, LOCAL-FIRST)
====================================================================
Objetivo: ganho de velocidade (IA), organiza√ß√£o (workspaces) e busca cl√≠nica.

5.1 Escopo V2 (delta sobre V1)
  [+] 30‚Äì50 templates curados (ampliar especialidades e coberturas comuns).
  [+] Generator (IA) para autopreencher campos a partir de sinais cl√≠nicos + CID‚Äë10.
  [+] Search (pgvector) para templates e docs por linguagem natural.
  [+] Workspaces (m√©dico, assistente) e ‚ÄúMinhas Pastas‚Äù (por paciente/atendimento).
  [+] Audit export avan√ßado (filtros por per√≠odo/ator).
  [+] Observabilidade de neg√≥cio (docs/dia, assinaturas, erros IA) e pain√©is simples.
  [+] Seguran√ßa: chaves por workspace; HMAC nos webhooks; CORS estrito.

5.2 Endpoints (V2 adicionais)
  AUTH/WS:
    POST /v1/auth/keys | GET/DEL /v1/auth/keys
    POST /v1/workspaces | GET /v1/workspaces/:id | POST /v1/workspaces/:id/members
  Generator (IA):
    POST /v1/generator/complete {templateId, patient, context} ‚Üí {fields_suggested, cautions, references?}
  Search (vetorial):
    GET  /v1/search?q=‚Ä¶&type=template|doc&specialty=‚Ä¶

5.3 Prompt-Library (packages/prompts)
  prescription.basic.txt ‚Äî entrada: sintomas, diagn√≥stico (CID‚Äë10), posologia, alertas/red flags.
  atestado.basic.txt ‚Äî entrada: CID‚Äë10, per√≠odo de afastamento, instru√ß√µes ao paciente/empresa.
  laudo.imagem.txt ‚Äî entrada: achados, impress√£o diagn√≥stica, recomenda√ß√µes.
  consent.term.txt ‚Äî entrada: procedimento, riscos comuns, alternativas.
  discharge.summary.txt ‚Äî entrada: evolu√ß√£o, prescri√ß√£o de alta, sinais de alarme.

5.4 UI/UX (V2)
  ‚Ä¢ Componentes cl√≠nicos: PrescriptionBuilder, AtestadoWizard, LaudoComposer, ConsentStudio, SignaturePanel, ShareSheet.
  ‚Ä¢ Fluxo One‚ÄëClick Doc: buscar ‚Üí escolher ‚Üí autopreencher ‚Üí editar ‚Üí assinar ‚Üí exportar/compartilhar.
  ‚Ä¢ Onboarding com ‚Äúplaygrounds‚Äù e exemplos de preenchimento.

5.5 Observabilidade/Seguran√ßa (V2)
  ‚Ä¢ M√©tricas: req/sec, p95, tokens IA, docs/dia, docs assinados, falhas IA.
  ‚Ä¢ Logs com traceId/user/workspace; webhooks com HMAC.
  ‚Ä¢ LGPD: consentimento expl√≠cito no compartilhamento; reten√ß√£o configur√°vel para ambiente de teste (ex.: 90 dias).

5.6 Setup/Tests (V2)
  ‚Ä¢ Migrations extras: vectors, workspaces, membership.
  ‚Ä¢ Testes: generator.spec, search.spec, workspaces.spec, webhooks.hmac.spec.
  ‚Ä¢ Aceite: ‚Äúcriar doc em < 60s‚Äù com autopreenchimento razo√°vel; recall de busca ‚â• 0,8 em queries de teste.

====================================================================
6) V3 ‚Äî ENTERPRISE-READY (SAAS MULTI‚ÄëTENANT)
====================================================================
Objetivo: escalar com isolamento, faturamento, assinatura real e integra√ß√µes cl√≠nicas.

6.1 Escopo V3 (delta sobre V2)
  [+] Multi-tenant real (tenant_id em todas entidades; storage segregado).
  [+] Billing & quotas (Free/Pro/Business/Enterprise; limites/m√™s; hooks de faturamento).
  [+] Assinatura ICP‚ÄëBrasil real (A1/A3) via provider plug√°vel; verifica√ß√£o OCSP/CRL.
  [+] Marketplace de Templates (curados e autorais) com fluxo editorial e versionamento.
  [+] Pap√©is avan√ßados: m√©dico, residente, preceptor, secret√°ria, auditor, admin da cl√≠nica.
  [+] SSO (OIDC/SAML), MFA (TOTP/U2F), RBAC detalhado por escopos.
  [+] RNDS/FHIR b√°sico (Patient, Practitioner, DocumentReference) ‚Äî export/import.
  [+] BYO‚ÄëLLM (chaves do cliente) e cache vetorial.
  [+] Pain√©is: produtividade/uso por tenant; export CSV/JSON; alertas de quota e p95.

6.2 Dados/Infra (V3)
  ‚Ä¢ Tabelas com tenant_id e √≠ndices compostos.
  ‚Ä¢ Prefixos de bucket S3 por tenant; chaves KMS segregadas (se aplic√°vel).
  ‚Ä¢ quotas/usage_counters com reset mensal e grace period.
  ‚Ä¢ billing_provider webhooks com HMAC + idempot√™ncia.

6.3 Endpoints (V3 adicionais)
  MULTI‚ÄëTENANT/BILLING:
    POST /v1/tenants | GET/PATCH /v1/tenants/:id
    GET  /v1/usage (quota/consumo)
    POST /v1/billing/subscribe | POST /v1/billing/portal
    POST /v1/billing/webhook
  SIGNATURE (real):
    POST /v1/signature/providers/:name/connect
    POST /v1/signature/sign {docId, certRef|pkcs12, pin?}
    GET  /v1/signature/verify/:docId
  MARKETPLACE:
    POST /v1/marketplace/templates (submit)
    GET  /v1/marketplace/templates?q=&specialty=
    POST /v1/marketplace/templates/:id/review
    POST /v1/marketplace/templates/:id/publish
  FHIR/RNDS:
    GET  /v1/fhir/DocumentReference/:id | POST /v1/fhir/DocumentReference
    GET  /v1/fhir/Patient/:id | POST /v1/fhir/Patient
    GET  /v1/fhir/Practitioner/:id | POST /v1/fhir/Practitioner

6.4 Seguran√ßa/Compliance (V3)
  ‚Ä¢ LGPD: DPIA, DPO, pol√≠ticas de reten√ß√£o e anonimiza√ß√£o; Data Subject Requests.
  ‚Ä¢ CFM/ANVISA: versionamento de templates, assinatura, hash, carimbo do tempo (opcional).
  ‚Ä¢ SSO/MFA; RBAC granular; logs de acesso por paciente/documento.

6.5 UI/UX (V3)
  ‚Ä¢ Admin Console (tenant): planos, quotas, convites, SSO, logs, integra√ß√µes, webhooks.
  ‚Ä¢ Marketplace tab: badges (‚Äúcurado‚Äù, ‚Äúmais usado‚Äù, ‚Äúnovo‚Äù), preview diffs e changelog.
  ‚Ä¢ Dashboards: produtividade, uso por plano, erros por etapa; export.

6.6 Observabilidade/FinOps (V3)
  ‚Ä¢ M√©tricas por tenant/plano; custos estimados (tokens, storage, assinatura).
  ‚Ä¢ Alertas: p95 > alvo; erros > threshold; quota 80/90/100%.
  ‚Ä¢ Auditoria export√°vel (JSONL assinado) por per√≠odo/tenant.

====================================================================
7) ESQUELETO DE REPO (ARQUIVOS/PASTAS) ‚Äî PARA O CLAUDE GERAR
====================================================================
/apps/repomed-api/src
  index.ts
  routes.ts
  plugins/{swagger.ts,metrics.ts,sse.ts}
  config/{env.ts,security.ts}
  core/{db.ts,storage.ts,cache.ts,logger.ts,events.ts}
  middleware/{error.handler.ts,request.context.ts,hmac.verify.ts}
  auth/{keys.controller.ts,keys.service.ts,rbac.ts}
  workspaces/{workspaces.controller.ts,workspaces.service.ts}
  templates/{templates.controller.ts,templates.service.ts,templates.repo.ts,templates.model.ts}
  generator/{generator.controller.ts,generator.service.ts,prompts/*.txt}
  clinical-docs/{docs.controller.ts,docs.service.ts,pdf.ts,share.ts}
  signature/{signature.controller.ts,signature.service.ts,providers/{mock.ts,providerX.sandbox.ts,providerX.real.ts}}
  clinical-audit/{audit.controller.ts,audit.service.ts}
  search/{search.controller.ts,search.service.ts}
  fhir/{patient.controller.ts,documentReference.controller.ts,practitioner.controller.ts}  # V3
  billing/{billing.controller.ts,billing.service.ts}                                      # V3
  webhooks/{webhooks.controller.ts}

/apps/repomed-web/src
  main.tsx, app/routes.tsx
  styles/{tailwind.css,theme.css}
  lib/{api.ts,forms.ts}
  components/ui/* (shadcn)
  components/clinical/{PrescriptionBuilder.tsx,AtestadoWizard.tsx,LaudoComposer.tsx,ConsentStudio.tsx,SignaturePanel.tsx,ShareSheet.tsx,TemplateCard.tsx,PatientPicker.tsx}
  pages/{Dashboard.tsx,Templates.tsx,NewDocument.tsx,Documents.tsx,AuditTrail.tsx}
  pages/Admin/{Tenants.tsx,Billing.tsx,Marketplace.tsx,Integrations.tsx}                  # V3
  providers/Toaster.tsx
  hooks/{useShortcuts.ts,useSearch.ts}
  store/* (zustand ou redux toolkit)

/packages
  ui/*              # tokens OKLCH + componentes compartilh√°veis
  schemas/*         # zod DTOs
  sdk/*             # cliente TS da API
  prompts/*         # prompt‚Äëlibrary cl√≠nica

/infra
  docker-compose.yml
  db/migrations/{0001_init_core.sql,0002_pgvector.sql,0003_templates.sql,0004_documents.sql,0005_audit.sql,0006_workspaces.sql,0007_vectors.sql,0100_tenants.sql,0101_billing.sql,0102_rbac_adv.sql}
  ops/{Makefile,seeds.ts,dev.sh}

/tests
  api/{templates.spec.ts,generator.spec.ts,docs.spec.ts,signature.mock.spec.ts,webhooks.hmac.spec.ts}
  e2e/{create-sign-share.spec.ts}
  security/{rate-limit.spec.ts}

/docs
  ARCHITECTURE.md, COMPLIANCE.md, PLAYBOOKS.md

====================================================================
8) PLAYBOOKS (PROMPTS CIR√öRGICOS PARA O CLAUDE CODER)
====================================================================
8.1 SETUP MONOREPO
‚ÄúCrie um monorepo PNPM/Turborepo com apps repomed-api (Fastify/TS) e repomed-web (React/Vite/Tailwind/shadcn).
 Adicione docker-compose (Postgres16 + pgvector, Redis, MinIO) e healthchecks.
 Configure /apps, /packages, /infra, /docs. Valide .env com Zod. Exponha /docs (Swagger) e /metrics (Prometheus).
 Gere migrations 0001‚Ä¶0005 para V1 e 0006‚Ä¶0007 para V2. Configure lint/prettier/husky.‚Äù

8.2 M√âDICAL TEMPLATES (CRUD + VERSIONAMENTO)
‚ÄúImplemente service ‚Äòmedical-templates‚Äô (controller/service/repo/model). Rotas:
 POST/GET/PUT/DEL /v1/medical-templates e POST /v1/medical-templates/:id/publish.
 Zod: TemplateCreate/Update/Version. Seeds de 10 templates. Testes templates.spec.ts.‚Äù

8.3 CLINICAL DOCS (PDF, HASH, QR, SHARE)
‚ÄúImplemente clinical-docs com gera√ß√£o de PDF (body_md + fields), hash_before/after, QR (URL de verifica√ß√£o),
 upload em MinIO e cria√ß√£o de link com expira√ß√£o. Rotas: POST /v1/clinical-docs, GET/DEL /:id, POST /:id/share.
 Teste E2E criando doc, assinando mock e abrindo o link.‚Äù

8.4 ASSINATURA (MOCK ‚Üí REAL)
‚ÄúDefina interface SignatureProvider (sign(buffer,meta)‚Üíresult). Implemente provider mock (V1/V2) e providerX.sandbox.
 Exponha POST /v1/clinical-docs/:id/sign (provider=mock). Para V3, construa provider real (A1/A3) e /v1/signature/verify/:docId
 com verifica√ß√£o OCSP/CRL.‚Äù

8.5 GENERATOR (IA) E PROMPT-LIB (V2)
‚ÄúCrie servi√ßo generator com provider de IA plug√°vel. Entrada: templateId, patient, context. Sa√≠da: fields_suggested, cautions.
 Use /packages/prompts com arquivos: prescription.basic.txt, atestado.basic.txt, laudo.imagem.txt, consent.term.txt, discharge.summary.txt.
 Testes unit√°rios com mocks do provider.‚Äù

8.6 SEARCH (PGVECTOR) (V2)
‚ÄúImplemente embeddings para templates e docs. Armazene em ‚Äòvectors‚Äô. Rota GET /v1/search com filtros. Teste recall/lat√™ncia.‚Äù

8.7 WORKSPACES + RBAC (V2‚ÜíV3)
‚ÄúCrie /v1/workspaces e membership; roles: m√©dico/assistente (V2) e residente/preceptor/auditor/admin (V3).
 Middleware request.context injeta workspace e user.‚Äù

8.8 WEBHOOKS (HMAC)
‚ÄúEmitter de eventos doc.generated/doc.signed/doc.shared. Assinar payload com HMAC por workspace. Rota /v1/clinical-webhooks/test.
 Rejeitar assinaturas inv√°lidas.‚Äù

8.9 UI/UX (WEB)
‚ÄúNo repomed-web, implemente fluxo One‚ÄëClick Doc com PrescriptionBuilder, AtestadoWizard etc.
 Use react-hook-form + zod, estados vazios guiados, atalhos (‚Äò/‚Äô buscar, ‚ÄòEnter‚Äô gerar), toasts, breadcrumbs.
 Tema OKLCH medical com alto contraste e acessibilidade.‚Äù

8.10 MULTI‚ÄëTENANT, BILLING, MARKETPLACE, FHIR (V3)
‚ÄúAdapte schemas para tenant_id, quotas e usage_counters. Conecte billing provider (webhook idempotente).
 Construa Admin Console, SSO OIDC/SAML, MFA, RBAC avan√ßado. Implemente marketplace de templates com review/publish.
 Exponha endpoints FHIR (Patient, Practitioner, DocumentReference). Testes E2E de cria√ß√£o/assinatura/export.‚Äù

====================================================================
9) ROTEIRO DE VALIDA√á√ÉO COM A M√âDICA (LOCAL)
====================================================================
Sess√£o V1 (60‚Äì90 min): criar 5 docs (um por especialidade), assinar mock, exportar/abrir link/QR. Ajustes de texto e campos.
Sess√£o V2 (60 min): IA preenchendo campos, busca por linguagem natural, fluxo com assistente, revis√£o do audit trail.
Sess√£o V3 (60‚Äì90 min): multi‚Äëtenant, quotas, marketplace (instalar 2 templates curados), assinatura real (se dispon√≠vel).

Crit√©rios de sucesso m√≠nimos:
  ‚Ä¢ Doc padr√£o em < 60s (V2) / < 90s (V1)
  ‚Ä¢ Hash/QR verific√°veis; trilha coerente
  ‚Ä¢ IA sugere campos com acur√°cia razo√°vel e sem alucina√ß√£o perigosa (mostrar cautions)
  ‚Ä¢ p95 < 500ms nas rotas CRUD/GET; erros < 1%

====================================================================
10) RISCOS & PLANOS B
====================================================================
‚Ä¢ ICP real: custo/integra√ß√£o ‚Üí manter mock no V1/V2 e ativar provider real apenas na V3 (clientes pagantes).
‚Ä¢ Custos de IA: cache de prompts/resultados; RAG leve; BYO‚ÄëLLM; limites por plano.
‚Ä¢ Interoperabilidade: iniciar com 3 recursos FHIR; expandir sob demanda.
‚Ä¢ Receitas controladas: postergar; focar atestados/laudos/relat√≥rios/termos no in√≠cio.

====================================================================
11) CHECKLISTS DE GO/NO‚ÄëGO
====================================================================
V1
 [ ] 15 templates revisados
 [ ] Gera√ß√£o PDF/QR/Hash + assinatura mock
 [ ] Share com expira√ß√£o
 [ ] Audit b√°sico + export
 [ ] Seguran√ßa/observabilidade baseline

V2
 [ ] 30‚Äì50 templates curados
 [ ] Generator (IA) + prompt‚Äëlibrary
 [ ] Search (pgvector)
 [ ] Workspaces (m√©dico/assistente)
 [ ] M√©tricas de neg√≥cio + HMAC webhooks

V3
 [ ] Tenancy/quotas/billing
 [ ] Assinatura real (A1/A3) + verifica√ß√£o
 [ ] Marketplace (review/publish)
 [ ] SSO/MFA/RBAC avan√ßado
 [ ] FHIR b√°sico
 [ ] Dashboards e export por tenant

FIM ‚Äî ‚ÄúBuild fast, validate faster‚Äù. Vamos decolar. üöÄ
