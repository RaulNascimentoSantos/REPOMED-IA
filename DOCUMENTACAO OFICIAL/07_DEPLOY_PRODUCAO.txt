========================================
REPOMED IA - DEPLOY PRODU√á√ÉO
========================================

ESTRAT√âGIAS DE DEPLOY:
=====================

1. CONTAINERIZA√á√ÉO COM DOCKER
------------------------------

VANTAGENS:
‚úÖ Ambiente isolado e consistente
‚úÖ F√°cil escalabilidade horizontal
‚úÖ Rollback r√°pido em caso de problemas
‚úÖ Compatibilidade multi-cloud

ESTRUTURA DE CONTAINERS:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ nginx-proxy     (Reverse Proxy)         ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ repomed-web (Frontend React)        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ repomed-api (Backend Fastify)       ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ postgres    (Database)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DOCKERFILE BACKEND (repomed-api/Dockerfile):
```dockerfile
FROM node:18-alpine

# Instalar depend√™ncias do sistema
RUN apk add --no-cache \
    chromium \
    nss \
    freetype \
    freetype-dev \
    harfbuzz \
    ca-certificates \
    ttf-freefont

# Definir vari√°veis do Puppeteer
ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser

# Criar diret√≥rio da aplica√ß√£o
WORKDIR /app

# Copiar package files
COPY package*.json ./

# Instalar depend√™ncias
RUN npm ci --only=production && npm cache clean --force

# Copiar c√≥digo fonte
COPY . .

# Criar usu√°rio n√£o-root
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

# Mudar ownership dos arquivos
RUN chown -R nodejs:nodejs /app
USER nodejs

# Expor porta
EXPOSE 8081

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:8081/health || exit 1

# Comando de inicializa√ß√£o
CMD ["npm", "start"]
```

DOCKERFILE FRONTEND (repomed-web/Dockerfile):
```dockerfile
# Build stage
FROM node:18-alpine as builder

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

# Production stage
FROM nginx:alpine

# Copiar arquivos buildados
COPY --from=builder /app/dist /usr/share/nginx/html

# Configura√ß√£o customizada do Nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost/ || exit 1

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

DOCKER-COMPOSE.YML:
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      POSTGRES_DB: repomed_ia
      POSTGRES_USER: repomed_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "5432:5432"
    networks:
      - repomed-network

  backend:
    build: ./repomed-api
    restart: unless-stopped
    environment:
      DATABASE_URL: postgresql://repomed_user:${DB_PASSWORD}@postgres:5432/repomed_ia
      NODE_ENV: production
      PORT: 8081
    depends_on:
      - postgres
    ports:
      - "8081:8081"
    networks:
      - repomed-network
    volumes:
      - ./uploads:/app/uploads
      - ./logs:/app/logs

  frontend:
    build: ./repomed-web
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - repomed-network

  nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - "443:443"
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - frontend
      - backend
    networks:
      - repomed-network

volumes:
  postgres_data:

networks:
  repomed-network:
    driver: bridge
```

2. DEPLOY EM VPS/SERVIDOR DEDICADO
-----------------------------------

CONFIGURA√á√ÉO DO SERVIDOR:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Sistema Operacional: Ubuntu 22.04 LTS   ‚îÇ
‚îÇ CPU: 2+ cores                           ‚îÇ
‚îÇ RAM: 4GB+ (8GB recomendado)             ‚îÇ
‚îÇ Storage: 50GB+ SSD                      ‚îÇ
‚îÇ Rede: IPv4 p√∫blico + firewall          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

SCRIPT DE INSTALA√á√ÉO (setup.sh):
```bash
#!/bin/bash

# Atualizar sistema
sudo apt update && sudo apt upgrade -y

# Instalar Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER

# Instalar Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Instalar Nginx (para proxy reverso)
sudo apt install nginx certbot python3-certbot-nginx -y

# Configurar firewall
sudo ufw allow ssh
sudo ufw allow http
sudo ufw allow https
sudo ufw --force enable

# Criar diret√≥rios do projeto
sudo mkdir -p /opt/repomed-ia
sudo chown $USER:$USER /opt/repomed-ia

echo "‚úÖ Servidor configurado com sucesso!"
echo "Pr√≥ximo passo: fazer deploy da aplica√ß√£o"
```

3. DEPLOY EM CLOUD (AWS/DigitalOcean)
-------------------------------------

AWS ECS (Elastic Container Service):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ Cluster ECS para containers           ‚îÇ
‚îÇ ‚Ä¢ RDS PostgreSQL para database          ‚îÇ
‚îÇ ‚Ä¢ ALB (Application Load Balancer)       ‚îÇ
‚îÇ ‚Ä¢ ECR para registry de containers       ‚îÇ
‚îÇ ‚Ä¢ CloudWatch para logs/m√©tricas         ‚îÇ
‚îÇ ‚Ä¢ Route 53 para DNS                     ‚îÇ
‚îÇ ‚Ä¢ ACM para certificados SSL            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

DigitalOcean App Platform:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚Ä¢ App Platform para containers          ‚îÇ
‚îÇ ‚Ä¢ Managed Database PostgreSQL           ‚îÇ
‚îÇ ‚Ä¢ Load Balancer                         ‚îÇ
‚îÇ ‚Ä¢ Container Registry                    ‚îÇ
‚îÇ ‚Ä¢ Monitoring & Alerting                 ‚îÇ
‚îÇ ‚Ä¢ Custom Domain + SSL                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

CONFIGURA√á√ÉO DE SSL/TLS:
========================

CERTIFICADO COM CERTBOT (Let's Encrypt):
```bash
# Instalar certbot
sudo apt install certbot python3-certbot-nginx

# Obter certificado
sudo certbot --nginx -d seudominio.com -d www.seudominio.com

# Renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar linha:
0 12 * * * /usr/bin/certbot renew --quiet
```

NGINX.CONF PARA PRODU√á√ÉO:
```nginx
upstream backend {
    server backend:8081;
}

upstream frontend {
    server frontend:80;
}

# Redirect HTTP to HTTPS
server {
    listen 80;
    server_name seudominio.com www.seudominio.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS Configuration
server {
    listen 443 ssl http2;
    server_name seudominio.com www.seudominio.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    
    # SSL Security Headers
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # Security Headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;

    # Frontend
    location / {
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # API
    location /api/ {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Timeout configurations
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # Health checks
    location /health {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        access_log off;
    }

    # Static files caching
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        proxy_pass http://frontend;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

VARI√ÅVEIS DE AMBIENTE PRODU√á√ÉO:
==============================

.env.production (Backend):
```env
# Database
DATABASE_URL=postgresql://user:pass@postgres:5432/repomed_ia

# Server
NODE_ENV=production
PORT=8081
HOST=0.0.0.0

# Security
JWT_SECRET=chave_jwt_super_segura_producao
SESSION_SECRET=chave_sessao_super_segura_producao
CORS_ORIGIN=https://seudominio.com

# SSL/Security
FORCE_HTTPS=true
TRUST_PROXY=true

# Logging
LOG_LEVEL=warn
LOG_FILE=/app/logs/app.log

# Performance
NODE_OPTIONS=--max-old-space-size=2048
UV_THREADPOOL_SIZE=16

# PDF
PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
PDF_TEMP_DIR=/app/temp/pdfs
```

.env.production (Frontend):
```env
VITE_API_URL=https://seudominio.com
VITE_APP_NAME=RepoMed IA
VITE_NODE_ENV=production
VITE_ENABLE_DEBUG=false
VITE_ENABLE_ANALYTICS=true
```

SCRIPT DE DEPLOY AUTOM√ÅTICO:
============================

deploy.sh:
```bash
#!/bin/bash

set -e  # Exit on any error

echo "üöÄ Iniciando deploy do RepoMed IA..."

# Configura√ß√µes
PROJECT_DIR="/opt/repomed-ia"
BACKUP_DIR="/opt/backups/repomed-ia"
DATE=$(date +%Y%m%d_%H%M%S)

# Criar backup do banco de dados
echo "üì¶ Criando backup do banco de dados..."
mkdir -p $BACKUP_DIR
docker exec postgres pg_dump -U repomed_user repomed_ia > $BACKUP_DIR/backup_$DATE.sql

# Parar containers antigos
echo "üõë Parando containers antigos..."
cd $PROJECT_DIR
docker-compose down

# Baixar c√≥digo atualizado
echo "üì• Baixando c√≥digo atualizado..."
git pull origin main

# Rebuild containers
echo "üî® Rebuilding containers..."
docker-compose build --no-cache

# Executar migra√ß√µes (se necess√°rio)
echo "üóÑÔ∏è Executando migra√ß√µes..."
# docker-compose run --rm backend npm run migrate

# Iniciar containers
echo "üöÄ Iniciando containers..."
docker-compose up -d

# Aguardar servi√ßos ficarem saud√°veis
echo "‚è≥ Aguardando servi√ßos ficarem saud√°veis..."
sleep 30

# Verificar health checks
echo "üîç Verificando health checks..."
curl -f http://localhost:8081/health || {
    echo "‚ùå Backend n√£o est√° saud√°vel!"
    docker-compose logs backend
    exit 1
}

curl -f http://localhost/ || {
    echo "‚ùå Frontend n√£o est√° respondendo!"
    docker-compose logs frontend
    exit 1
}

# Limpeza
echo "üßπ Limpando images antigas..."
docker image prune -f

echo "‚úÖ Deploy conclu√≠do com sucesso!"
echo "üåê Aplica√ß√£o dispon√≠vel em: https://seudominio.com"
```

MONITORAMENTO E ALERTAS:
========================

DOCKER COMPOSE COM MONITORING:
```yaml
  prometheus:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml

  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      GF_SECURITY_ADMIN_PASSWORD: senha_segura
    volumes:
      - grafana_data:/var/lib/grafana

  node-exporter:
    image: prom/node-exporter
    ports:
      - "9100:9100"

volumes:
  grafana_data:
```

BACKUP AUTOM√ÅTICO:
==================

backup.sh:
```bash
#!/bin/bash

BACKUP_DIR="/opt/backups/repomed-ia"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

# Criar diret√≥rio de backup
mkdir -p $BACKUP_DIR

# Backup do banco de dados
docker exec postgres pg_dump -U repomed_user repomed_ia | gzip > $BACKUP_DIR/db_backup_$DATE.sql.gz

# Backup de uploads (se existir)
if [ -d "/opt/repomed-ia/uploads" ]; then
    tar -czf $BACKUP_DIR/uploads_backup_$DATE.tar.gz -C /opt/repomed-ia uploads/
fi

# Backup de configura√ß√µes
tar -czf $BACKUP_DIR/config_backup_$DATE.tar.gz -C /opt/repomed-ia .env docker-compose.yml nginx.conf

# Remover backups antigos
find $BACKUP_DIR -name "*.gz" -mtime +$RETENTION_DAYS -delete
find $BACKUP_DIR -name "*.sql.gz" -mtime +$RETENTION_DAYS -delete

echo "‚úÖ Backup conclu√≠do: $DATE"
```

Crontab para backup autom√°tico:
```bash
# Backup di√°rio √†s 2:00 AM
0 2 * * * /opt/scripts/backup.sh >> /var/log/repomed-backup.log 2>&1
```

ROLLBACK EM CASO DE PROBLEMAS:
==============================

rollback.sh:
```bash
#!/bin/bash

set -e

BACKUP_DIR="/opt/backups/repomed-ia"
PROJECT_DIR="/opt/repomed-ia"

echo "‚ö†Ô∏è  Iniciando rollback..."

# Listar backups dispon√≠veis
echo "Backups dispon√≠veis:"
ls -la $BACKUP_DIR/*.sql.gz | tail -5

read -p "Digite o nome do backup para restaurar (ex: db_backup_20240115_020001.sql.gz): " BACKUP_FILE

if [ ! -f "$BACKUP_DIR/$BACKUP_FILE" ]; then
    echo "‚ùå Backup n√£o encontrado!"
    exit 1
fi

# Parar aplica√ß√£o
cd $PROJECT_DIR
docker-compose down

# Restaurar banco de dados
echo "üîÑ Restaurando banco de dados..."
gunzip -c $BACKUP_DIR/$BACKUP_FILE | docker exec -i postgres psql -U repomed_user -d repomed_ia

# Voltar para commit anterior (opcional)
git reset --hard HEAD~1

# Rebuild e restart
docker-compose build
docker-compose up -d

echo "‚úÖ Rollback conclu√≠do!"
```

CHECKLIST DE DEPLOY:
====================

PR√â-DEPLOY:
‚òê Testes passando em ambiente de desenvolvimento
‚òê Backup do banco de dados criado
‚òê Vari√°veis de ambiente configuradas
‚òê Certificados SSL v√°lidos
‚òê Firewall configurado corretamente
‚òê Monitoramento configurado

P√ìS-DEPLOY:
‚òê Health checks passando
‚òê Frontend acess√≠vel via HTTPS
‚òê API respondendo corretamente
‚òê Logs sem erros cr√≠ticos
‚òê M√©tricas de performance normais
‚òê Backup autom√°tico configurado
‚òê Alertas de monitoramento ativos

TROUBLESHOOTING PRODU√á√ÉO:
=========================

Container n√£o inicia:
```bash
# Verificar logs
docker-compose logs service_name

# Verificar recursos
docker stats

# Verificar rede
docker network ls
```

Banco de dados inacess√≠vel:
```bash
# Verificar status do PostgreSQL
docker exec postgres pg_isready -U repomed_user

# Verificar conex√µes
docker exec postgres psql -U postgres -c "SELECT * FROM pg_stat_activity;"
```

Performance ruim:
```bash
# Verificar uso de recursos
htop
df -h
free -m

# Logs de performance
docker-compose logs backend | grep "slow"
```